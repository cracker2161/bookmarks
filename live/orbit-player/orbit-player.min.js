class OrbitPlayer{constructor(e,t={}){this.options={autoplay:!1,muted:!1,controls:!0,title:"",speed:1,quality:"auto",volume:1,thumbnails:!1,...t},this.video=document.querySelector(e),this.init()}init(){this.setupPlayer(),this.setupProviders(),this.setupControls(),this.setupEvents(),this.setupHotkeys(),this.setupGestures()}setupPlayer(){this.container=document.createElement("div"),this.container.className="orbit-player",this.video.parentNode.insertBefore(this.container,this.video),this.container.appendChild(this.video),this.spinner=document.createElement("div"),this.spinner.className="orbit-spinner",this.container.appendChild(this.spinner),this.options.title&&(this.titleBar=document.createElement("div"),this.titleBar.className="orbit-title",this.titleBar.textContent=this.options.title,this.container.appendChild(this.titleBar)),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&this.container.classList.add("mobile")}setupProviders(){const e=this.video.src;if(e.includes(".m3u8")){const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/hls.js@latest",t.onload=()=>{if(Hls.isSupported()){const t=new Hls;t.loadSource(e),t.attachMedia(this.video),t.on(Hls.Events.MANIFEST_PARSED,()=>{this.qualities=t.levels,this.setupQualityMenu()})}},document.head.appendChild(t)}}setupControls(){this.controls=document.createElement("div"),this.controls.className="orbit-controls",this.controls.innerHTML=`
            <div class="orbit-progress-wrap">
                <div class="orbit-progress">
                    <div class="orbit-buffer-bar"></div>
                    <div class="orbit-progress-bar"></div>
                    <div class="orbit-progress-hover"></div>
                </div>
            </div>
            <div class="orbit-buttons">
                <div class="orbit-left">
                    <button class="orbit-button orbit-play" data-tooltip="Play">
                        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                    <button class="orbit-button orbit-rewind" data-tooltip="Rewind 10s">
                        <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg>
                    </button>
                    <button class="orbit-button orbit-forward" data-tooltip="Forward 10s">
                        <svg viewBox="0 0 24 24"><path d="M12 5V1l5 5-5 5V7c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6h2c0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8z"/></svg>
                    </button>
                    <div class="orbit-volume">
                        <button class="orbit-button orbit-mute" data-tooltip="Mute">
                            <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg>
                        </button>
                        <div class="orbit-volume-slider">
                            <div class="orbit-volume-bar"></div>
                        </div>
                    </div>
                    <div class="orbit-time">0:00 / 0:00</div>
                </div>
                <div class="orbit-center">
                    <button class="orbit-button orbit-speed" data-tooltip="Playback Speed">
                        <svg viewBox="0 0 24 24"><path d="M10 8v8l6-4-6-4zM6.5 16h-2v2H3v-2H1v-1.5h2v-2h1.5v2h2V16zm14.5 0h-2v2h-1.5v-2h-2v-1.5h2v-2H19v2h2V16z"/></svg>
                        <div class="orbit-speed-menu">
                            <button class="orbit-menu-item" data-speed="0.5">0.5x</button>
                            <button class="orbit-menu-item" data-speed="1" class="active">Normal</button>
                            <button class="orbit-menu-item" data-speed="1.5">1.5x</button>
                            <button class="orbit-menu-item" data-speed="2">2x</button>
                        </div>
                    </button>
                    <button class="orbit-button orbit-quality" data-tooltip="Quality">
                        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/></svg>
                        <div class="orbit-quality-menu"></div>
                    </button>
                    <button class="orbit-button orbit-pip" data-tooltip="Picture in Picture">
                        <svg viewBox="0 0 24 24"><path d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"/></svg>
                    </button>
                </div>
                <div class="orbit-right">
                    <button class="orbit-button orbit-captions" data-tooltip="Subtitles">
                        <svg viewBox="0 0 24 24"><path d="M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 7H9.5v-.5h-2v3h2V13H11v1c0 .55-.45 1-1 1H7c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1zm7 0h-1.5v-.5h-2v3h2V13H18v1c0 .55-.45 1-1 1h-3c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1h3c.55 0 1 .45 1 1v1z"/></svg>
                    </button>
                    <button class="orbit-button orbit-fullscreen" data-tooltip="Fullscreen">
                        <svg viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                    </button>
                </div>
            </div>`,this.container.appendChild(this.controls)}setupEvents(){const e=this.controls.querySelector(".orbit-play");e.addEventListener("click",()=>this.togglePlay());const t=this.controls.querySelector(".orbit-mute");t.addEventListener("click",()=>this.toggleMute());const s=this.controls.querySelector(".orbit-volume-slider");s.addEventListener("input",e=>{const t=s.getBoundingClientRect(),i=(e.clientX-t.left)/t.width;this.setVolume(Math.max(0,Math.min(1,i)))});const i=this.controls.querySelector(".orbit-progress-wrap");i.addEventListener("mousemove",e=>{const t=i.getBoundingClientRect(),s=(e.clientX-t.left)/t.width,n=this.video.duration*s,o=this.controls.querySelector(".orbit-progress-hover");o.style.left=e.clientX-t.left+"px",o.textContent=this.formatTime(n),o.style.display="block"}),i.addEventListener("mouseleave",()=>{this.controls.querySelector(".orbit-progress-hover").style.display="none"}),i.addEventListener("click",e=>{const t=i.getBoundingClientRect(),s=(e.clientX-t.left)/t.width;this.video.currentTime=s*this.video.duration});const n=this.controls.querySelector(".orbit-rewind");n.addEventListener("click",()=>{this.video.currentTime-=10});const o=this.controls.querySelector(".orbit-forward");o.addEventListener("click",()=>{this.video.currentTime+=10});const r=this.controls.querySelector(".orbit-speed");r.addEventListener("click",()=>{this.controls.querySelector(".orbit-speed-menu").classList.toggle("active")});const a=this.controls.querySelectorAll(".orbit-speed-menu .orbit-menu-item");a.forEach(e=>{e.addEventListener("click",t=>{const s=parseFloat(e.dataset.speed);this.video.playbackRate=s,a.forEach(e=>e.classList.remove("active")),e.classList.add("active")})});const l=this.controls.querySelector(".orbit-fullscreen");l.addEventListener("click",()=>this.toggleFullscreen());const c=this.controls.querySelector(".orbit-pip");document.pictureInPictureEnabled&&c.addEventListener("click",()=>this.togglePiP()),this.video.addEventListener("play",()=>{const t=this.controls.querySelector(".orbit-play svg");t.innerHTML='<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>',this.container.classList.add("playing")}),this.video.addEventListener("pause",()=>{const t=this.controls.querySelector(".orbit-play svg");t.innerHTML='<path d="M8 5v14l11-7z"/>',this.container.classList.remove("playing")}),this.video.addEventListener("timeupdate",()=>{this.updateProgress(),this.updateTime()}),this.video.addEventListener("progress",()=>{this.updateBuffer()}),this.video.addEventListener("waiting",()=>this.container.classList.add("loading")),this.video.addEventListener("playing",()=>this.container.classList.remove("loading")),this.video.addEventListener("error",()=>{const e=document.createElement("div");e.className="orbit-error",e.textContent="Video loading error",this.container.appendChild(e)})}setupGestures(){let e=0;this.container.addEventListener("click",t=>{t.target===this.video&&(Date.now()-e<300?this.toggleFullscreen():e=Date.now())})}setupHotkeys(){document.addEventListener("keydown",e=>{if(!this.container.contains(document.activeElement))return;switch(e.key.toLowerCase()){case" ":case"k":e.preventDefault(),this.togglePlay();break;case"m":e.preventDefault(),this.toggleMute();break;case"f":e.preventDefault(),this.toggleFullscreen();break;case"arrowleft":e.preventDefault(),this.video.currentTime-=10;break;case"arrowright":e.preventDefault(),this.video.currentTime+=10;break;case"arrowup":e.preventDefault(),this.setVolume(Math.min(1,this.video.volume+.1));break;case"arrowdown":e.preventDefault(),this.setVolume(Math.max(0,this.video.volume-.1))}})}togglePlay(){this.video.paused?this.video.play():this.video.pause()}toggleMute(){this.video.muted=!this.video.muted,this.updateVolumeUI()}setVolume(e){this.video.volume=e,this.video.muted=0===e,this.updateVolumeUI()}updateVolumeUI(){const e=this.controls.querySelector(".orbit-volume-bar"),t=this.controls.querySelector(".orbit-mute svg");e.style.width=100*(this.video.muted?0:this.video.volume)+"%",t.innerHTML=this.video.muted||0===this.video.volume?'<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>':`<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>`}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.container.requestFullscreen()}async togglePiP(){document.pictureInPictureElement?await document.exitPictureInPicture():await this.video.requestPictureInPicture()}updateProgress(){const e=this.controls.querySelector(".orbit-progress-bar"),t=this.video.currentTime/this.video.duration*100;e.style.width=t+"%"}updateBuffer(){const e=this.controls.querySelector(".orbit-buffer-bar");if(this.video.buffered.length>0){const t=this.video.buffered.end(this.video.buffered.length-1)/this.video.duration*100;e.style.width=t+"%"}}updateTime(){const e=this.controls.querySelector(".orbit-time");e.textContent=`${this.formatTime(this.video.currentTime)} / ${this.formatTime(this.video.duration)}`}formatTime(e){if(!isFinite(e))return"0:00";const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s<10?"0":""}${s}`}}window.OrbitPlayer=OrbitPlayer;
