<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>M3U Pro</title>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAFdQTFRF////4Z6e7rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW14Z6e////z0JsYQAAAAd0Uk5TAB+Qz+/vkB8DepUOVQAAAAFiS0dEHesDcZEAAAAJcEhZcwAAAEgAAABIAEbJaz4AAABrSURBVDjL7dA5EoAgEETRQXEXFHfm/kc1SmICKgksPsn/dVc10ZeZXQPQAQgeCJA8ELQOoAUhA8kD0QG1CejjHPAAM0HuHmBHBNoHQskL8EwERAshPgDKA6H2e8B/wK2vwHwAmX1Ad93U5wK5DiHwZkZcmwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wMS0xNlQwMDo0NzoxMiswMDowMCX1KewAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDEtMTZUMDA6NDc6MTIrMDA6MDBUqJFQAAAAAElFTkSuQmCC">
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAFdQTFRF////4Z6e7rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW17rW14Z6e////z0JsYQAAAAd0Uk5TAB+Qz+/vkB8DepUOVQAAAAFiS0dEHesDcZEAAAAJcEhZcwAAAEgAAABIAEbJaz4AAABrSURBVDjL7dA5EoAgEETRQXEXFHfm/kc1SmICKgksPsn/dVc10ZeZXQPQAQgeCJA8ELQOoAUhA8kD0QG1CejjHPAAM0HuHmBHBNoHQskL8EwERAshPgDKA6H2e8B/wK2vwHwAmX1Ad93U5wK5DiHwZkZcmwAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wMS0xNlQwMDo0NzoxMiswMDowMCX1KewAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDEtMTZUMDA6NDc6MTIrMDA6MDBUqJFQAAAAAElFTkSuQmCC">
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #3b82f6;
            --text: #f8fafc;
            --text-dim: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .app {
            max-width: 100%;
            margin: 0 auto;
            padding: 0.5rem;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 0.5rem;
            text-align: center;
        }

        .header h1 {
            font-size: 1.2rem;
            color: var(--accent);
        }

        .input-box {
            background: var(--card);
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }

        input {
            width: 100%;
            padding: 0.5rem;
            background: var(--bg);
            border: 1px solid var(--card);
            border-radius: 0.3rem;
            color: var(--text);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: 0.3rem;
            width: 100%;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            margin: 0.5rem 0;
        }

        .view-btn {
            flex: 1;
            padding: 0.5rem;
            background: var(--card);
            border: none;
            border-radius: 0.3rem;
            color: var(--text-dim);
            font-size: 0.8rem;
        }

        .view-btn.active {
            background: var(--accent);
            color: white;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem 0;
        }

        .channels {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.5rem;
        }

        .channel {
            background: var(--card);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .ch-img {
            width: 100%;
            height: 80px;
            object-fit: contain;
            background: var(--bg);
        }

        .ch-info {
            padding: 0.5rem;
        }

        .ch-name {
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ch-group {
            font-size: 0.7rem;
            color: var(--accent);
            margin-bottom: 0.3rem;
        }

        .ch-btns {
            display: flex;
            gap: 0.3rem;
        }

        .ch-btn {
            flex: 1;
            padding: 0.3rem;
            font-size: 0.7rem;
            border-radius: 0.2rem;
        }

        .raw {
            display: none;
            background: var(--card);
            padding: 0.5rem;
            border-radius: 0.5rem;
            height: 100%;
            position: relative;
        }

        .raw pre {
            font-family: monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 100%;
            overflow-y: auto;
            padding-right: 2.5rem;
        }

        .copy-raw {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.3rem;
            font-size: 0.7rem;
        }

        .toast {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 0.3rem;
            font-size: 0.8rem;
            display: none;
            z-index: 1000;
        }

        .loading {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid var(--card);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (min-width: 768px) {
            .app {
                max-width: 1200px;
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }

            .channels {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .ch-img {
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>M3U Pro</h1>
        </div>

        <div class="input-box">
            <input type="url" id="url" placeholder="Enter M3U URL">
            <button class="btn" onclick="parse()">Load</button>
        </div>

        <div class="view-toggle">
            <button class="view-btn active" onclick="view('list')">Channels</button>
            <button class="view-btn" onclick="view('raw')">Raw</button>
        </div>

        <div class="content">
            <div id="channels" class="channels"></div>
            <div id="raw" class="raw">
                <pre id="rawText"></pre>
                <button class="btn copy-raw" onclick="copyRaw()">Copy</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <div id="loading" class="loading" style="display:none">
        <div class="spinner"></div>
    </div>

    <script>
        let m3u = '';

        async function parse() {
            const url = document.getElementById('url').value.trim();
            if (!url) {
                toast('Enter URL');
                return;
            }

            loading(true);
            try {
                const res = await fetch(url);
                if (!res.ok) throw new Error('Failed to load');
                
                m3u = await res.text();
                const channels = parseM3u(m3u);
                showChannels(channels);
                document.getElementById('rawText').textContent = m3u;
                toast('Loaded ' + channels.length + ' channels');
            } catch (e) {
                toast(e.message);
            }
            loading(false);
        }

        function parseM3u(text) {
            const lines = text.split('\n');
            const channels = [];
            let ch = null;

            lines.forEach(line => {
                line = line.trim();
                if (line.startsWith('#EXTINF:')) {
                    ch = {};
                    const logo = line.match(/tvg-logo="([^"]+)"/);
                    const group = line.match(/group-title="([^"]+)"/);
                    const name = line.match(/,(.+)$/);
                    
                    ch.logo = logo ? logo[1] : '';
                    ch.group = group ? group[1] : '';
                    ch.name = name ? name[1].trim() : 'No Name';
                } else if (line && !line.startsWith('#') && ch) {
                    ch.url = line;
                    channels.push(ch);
                    ch = null;
                }
            });

            return channels;
        }

        function showChannels(channels) {
            const grid = document.getElementById('channels');
            grid.innerHTML = channels.map(ch => `
                <div class="channel">
                    <img class="ch-img" src="${ch.logo || '#'}" 
                         onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 50 50\"><text x=\"25\" y=\"25\" font-family=\"Arial\" font-size=\"20\" fill=\"%23fff\" text-anchor=\"middle\" dy=\".3em\">${ch.name[0]}</text></svg>'">
                    <div class="ch-info">
                        <div class="ch-name">${ch.name}</div>
                        ${ch.group ? `<div class="ch-group">${ch.group}</div>` : ''}
                        <div class="ch-btns">
                            <button class="btn ch-btn" onclick="copy('${ch.url}')">Copy</button>
                            <button class="btn ch-btn" onclick="play('${ch.url}')">Play</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function view(type) {
            const btns = document.querySelectorAll('.view-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const list = document.getElementById('channels');
            const raw = document.getElementById('raw');
            
            list.style.display = type === 'list' ? 'grid' : 'none';
            raw.style.display = type === 'raw' ? 'block' : 'none';
        }

        async function copy(text) {
            try {
                await navigator.clipboard.writeText(text);
                toast('Copied');
            } catch {
                toast('Copy failed');
            }
        }

        async function copyRaw() {
            try {
                await navigator.clipboard.writeText(m3u);
                toast('Copied raw M3U');
            } catch {
                toast('Copy failed');
            }
        }

        function play(url) {
            window.open(url, '_blank');
        }

        function toast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 2000);
        }

        function loading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        // PWA support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(console.error);
        }
    </script>
</body>
</html>
